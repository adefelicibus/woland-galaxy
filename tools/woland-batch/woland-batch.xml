<tool id="woland" name="Woland" version="0.1.0" profile="17.01">
    <description>Point Mutation Profiles from Resequencing Genomics Data</description>
    <requirements>
        <requirement type="package" version="5.22.2.1">perl</requirement>
        <requirement type="package" version="2.3.0">bowtie2</requirement>
        <requirement type="package" version="3.2.2">r-base</requirement>
        <requirement type="package" version="1.25">perl-ipc-system-simple</requirement>
        <requirement type="package" version="0.94">perl-ipc-run</requirement>
        <requirement type="package" version="1.17">perl-parallel-forkmanager</requirement>
        <requirement type="package" version="2016060801">perl-regexp-common</requirement>
        <requirement type="package" version="2.03">perl-text-balanced</requirement>
        <requirement type="package" version="2013.0523">perl-text-wrap</requirement>
        <requirement type="package" version="0.34">perl-statistics-r</requirement>
        <requirement type="package" version="3.40">perl-pathtools</requirement>
        <requirement type="package" version="1.42">perl-scalar-list-utils</requirement>
        <requirement type="package" version="1.6.924">perl-bioperl</requirement>
        <requirement type="package" version="2.49">perl-getopt-long</requirement>
        <requirement type="package" version="0.1.2">r-qqman</requirement>
        <requirement type="package" version="1.1.2">r-rcolorbrewer</requirement>
        <requirement type="package" version="1.8.3">r-plyr</requirement>
        <requirement type="package" version="3.5.0">r-gtools</requirement>
        <requirement type="package" version="1.4.1">r-reshape2</requirement>
        <requirement type="package" version="2.1.0">r-ggplot2</requirement>
    </requirements>
    <stdio>
        <exit_code range="1:" />
    </stdio>
    <command><![CDATA[
        ## prepare bowtie2 index
        #set index_path = ''
        #if str($reference_genome.source) == "history":
            bowtie2-build --threads \${GALAXY_SLOTS:-4} '$reference_genome.own_file' genome &&
            ln -s -f '$reference_genome.own_file' genome.fa &&
            #set index_path = 'genome'
        #else:
            #set index_path = $reference_genome.index.fields.path
        #end if

        python '${__tool_directory__}/woland-batch.py' 
        -i "$input_table"
        -d "${html_file.files_path}"
        -o "$html_file"
        -j "$input_table.name"
        -c "$chromosome_profile"
        -p "$chromosome_profile.name"
        -r "$refseq"
        -f "$refseq.name"
        -w "$hotspot_window"
        -g "$index_path"

    ]]></command>
    <inputs>
        <param type="data" name="input_table" format="txt" label="Input table" help="Tab-delimited file with samples in the 1st column and groups in the 2nd column."/>
        <param type="data" name="chromosome_profile" format="txt" label="Chromosome Length Profile" help="Tab-delimited file with chr names in the 1st column and target sequenced length in the 2nd column."/>
        <param type="integer" name="hotspot_window" label="Hotspot Window Length" value="1000" min="1" help="Natural number for hotspot window-length"/>

        <conditional name="reference_genome">
          <param name="source" type="select" label="Will you select a reference genome from your history or use a built-in index?" help="Built-ins were indexed using default options. See Indexes section of help below">
            <option value="indexed">Use a built-in genome index</option>
            <option value="history">Use a genome from the history and build index</option>
          </param>
          <when value="indexed">
            <param name="index" type="select" label="Select reference genome" help="If your genome of interest is not listed, contact the Galaxy team">
              <options from_data_table="bowtie2_indexes">
                <filter type="sort_by" column="2"/>
                <validator type="no_options" message="No indexes are available for the selected input dataset"/>
              </options>
            </param>
          </when>
          <when value="history">
            <param name="own_file" type="data" format="fasta" label="Select reference genome" />
          </when>
        </conditional>

        <param type="text" name="genome_version" label="Genome Version" help="String for genome version for genome and annotation files."/>
        <param type="data" name="refseq" format="txt" label="RefSeq" help=""/>

    </inputs>
    <outputs>
        <data format="html" name="html_file" label="${tool.name} on ${on_string}: report" />
        <!-- <data format="txt" name="text_file"  label="${tool.name} on ${on_string}: RawData" /> -->
    </outputs>
    <tests>
        <test>
            <param name="source" value="history" />
            <param name="own_file" value="genomes/genome_ecolik12.fa" />
            <param name="input_table" value="input-table-ecoli_6groups.txt"/>
            <param name="refseq" value="genomes/refseq_ecolik12.txt"/>
            <param name="chromosome_profile" value="profiles/chromosomeprofile-ecolik12_MG1655.txt"/>
            <param name="hotspot_window" value="1000"/>
            <param name="genome_version" value="ecolik12"/>
            <output name="html_file" file="woland_batch.html" ftype="html"/>
        </test>
    </tests>
    <help><![CDATA[
        usage: woland-batch.pl --genome-version|-g --hotspot-window-length|-w
--chromosome-length-profile|-c --input-table|-i [--help|-h] [--threads|-t]

WOLAND is a multiplatform tool to analyze point mutation patterns using
resequencing SNV data.		Use woland-batch to run multiple samples as in
<input-table> using woland-anno.pl and build a grouped report using
woland-report.pl. For more details please read README

required named arguments:
  --genome-version, -g GENOME-VERSION                            String for genome version for genome and annotation files
                                                                   in genomes/ folder
  --hotspot-window-length, -w HOTSPOT-WINDOW-LENGTH              Natural number for hotspot window-length
                                                                   Default: 1000
  --chromosome-length-profile, -c CHROMOSOME-LENGTH-PROFILE      Tab-delimited file with chr names in the 1st column and
                                                                   target sequenced length in the 2nd column
  --input-table, -i INPUT-TABLE                                  Tab-delimited file with samples in the 1st column and
                                                                   groups in the 2nd column

optional named arguments:
  --help, -h               ? show this help message and exit
  --threads, -t THREADS    ? Set a number for the maximum number of threads
                               Default: 30

If you used Woland in your research, we would appreciate your citation:
	de Souza TA, Defelicibus A, Menck CF

    ]]></help>
    <citations>
        <citation type="bibtex">
@misc{githubwoland,
  author = {LastTODO, FirstTODO},
  year = {TODO},
  title = {woland},
  publisher = {GitHub},
  journal = {GitHub repository},
  url = {https://github.com/tiagoantonio/woland},
}</citation>
    </citations>
</tool>